const editor=document.getElementById("editor");const PLACEHOLDER_TEXT="drag and drop or paste your code here.";function updatePlaceholder(){const a=!editor.textContent.trim()||editor.textContent===PLACEHOLDER_TEXT;a?(editor.classList.add("placeholder"),editor.textContent=PLACEHOLDER_TEXT):editor.classList.remove("placeholder")}updatePlaceholder();editor.addEventListener("focus",()=>{editor.classList.contains("placeholder")&&(editor.textContent="",editor.classList.remove("placeholder"))});editor.addEventListener("blur",()=>{updatePlaceholder()});let lastProcessedHash="",debounceTimer=null;const SENSITIVE_KEYWORDS=['admin','secret','internal','bearer','www-authenticate','password','token','key','api_key','auth','authentication','authorization','jwt','credential','private','confidential','sensitive','restricted','privileged','backup','debug','test','staging','production','localhost','127.0.0.1','0.0.0.0','env','environment','config','configuration','database','db','user','username','login','pass','hash','encrypt','decrypt','ssh','ftp','sftp','aws','azure','gcp','cloud','endpoint','url','uri','webhook','callback'];function processContent(){const a=editor.innerText;if(a===PLACEHOLDER_TEXT||!a.trim()){updatePlaceholder();updateSidebar([]);return}const e=a.length+"|"+a.slice(0,100)+"|"+a.slice(-100);if(e===lastProcessedHash)return;setTimeout(()=>{const t=advancedBeautify(a),o=scanSensitivePatterns(t),n=annotateSensitive(t,o);if(n!==editor.innerHTML){const e=saveSelection();editor.innerHTML=n,restoreSelection(e);editor.textContent.trim()||updatePlaceholder()}updateSidebar(o);lastProcessedHash=e},0)}function advancedBeautify(a){try{return formatJavaScript(a)}catch(e){console.error("Beautify error:",e);return a}}function formatJavaScript(a){let e="",t=0,o=2,n=!1,c="",l=!1,s=!1,i=!1,r=!1;for(let d=0;d<a.length;d++){const f=a[d],m=a[d+1]||"";if(l){e+=f,l=!1;continue}if(!n&&!r){if(!i&&f==="/"&&m==="/"){s=!0,e+=f;continue}if(!i&&f==="/"&&m==="*"){i=!0,e+=f;continue}if(i&&f==="*"&&m==="/"){i=!1,e+="*/",d++;continue}if(s&&f==="\n")s=!1}if(s||i){e+=f;continue}if(f==="\\"){l=!0,e+=f;continue}if(n){e+=f;if(f===c){n=!1}continue}if(r){e+=f;if(f==="`")r=!1;continue}if(f==='"'||f==="'"){n=!0,c=f,e+=f;continue}if(f==="`"){r=!0,e+=f;continue}if(f==="}"){t=Math.max(0,t-1),e=e.trimEnd()+"\n"+" ".repeat(t*o)+"}";continue}if(f==="{"){e=e.trimEnd()+" {\n"+" ".repeat(++t*o);continue}if(f===";"){e+=";";m&&m!=="\n"&&m!=="\r"&&(e+="\n"+" ".repeat(t*o));continue}if(f==="\n"){e+="\n"+" ".repeat(t*o);continue}e+=f}return e}function scanSensitivePatterns(a){const e=[];const t=[{type:"url",regex:/\bhttps?:\/\/[^\s"'<>]{8,}/gi,className:"hl-url"},{type:"jwt",regex:/\beyJ[A-Za-z0-9_-]{10,}\.[A-Za-z0-9_-]{10,}\.[A-Za-z0-9_-]{10,}\b/g,className:"hl-jwt"},{type:"aws_key",regex:/\b(AKIA|ASIA)[A-Z0-9]{16}\b/g,className:"hl-aws"},{type:"api_key",regex:/\b(sk_|pk_|key_)[a-z0-9_-]{20,}\b/gi,className:"hl-api"},{type:"hex_token",regex:/\b[a-f0-9]{32,}\b/gi,className:"hl-hex"},{type:"base64",regex:/\b[A-Za-z0-9+/]{30,}={0,2}\b/g,className:"hl-b64"},{type:"endpoint",regex:/\b(api|v[0-9])\/[a-z0-9_/-]{3,}\b/gi,className:"hl-endpoint"},{type:"secret_var",regex:/(password|passwd|secret|token|key|api[_-]?key)\s*[:=]\s*['"]?([^'"\s,;]{8,})['"]?/gi,className:"hl-secret",group:2}];SENSITIVE_KEYWORDS.forEach(o=>{const n=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");t.push({type:"keyword",regex:new RegExp("\\b"+n+"\\b","gi"),className:"hl-keyword",keyword:o})});t.forEach(o=>{const n=new RegExp(o.regex.source,o.regex.flags);let c;while((c=n.exec(a))!==null){const l=o.group?c[o.group]:c[0],s=o.group?c.index+c[0].indexOf(l):c.index;e.push({type:o.type,value:l,index:s,length:l.length,className:o.className,keyword:o.keyword,line:getLineNumber(a,s)})}});e.sort((o,n)=>o.index-n.index);const o=[];let n=0;e.forEach(c=>{c.index>=n&&(o.push(c),n=c.index+c.length)});return o}function getLineNumber(a,e){return a.substring(0,e).split("\n").length}function annotateSensitive(a,e){if(!e.length)return escapeHtml(a).replace(/\n/g,"<br>");e.sort((t,o)=>o.index-t.index);let t=escapeHtml(a);return e.forEach(o=>{const n=t.slice(0,o.index),c=t.slice(o.index,o.index+o.length),l=t.slice(o.index+o.length);t=n+`<span class="${o.className}" data-type="${o.type}" data-line="${o.line||0}" data-keyword="${o.keyword||''}">`+c+"</span>"+l}),t.replace(/\n/g,"<br>")}function escapeHtml(a){const e=document.createElement("div");return e.textContent=a,e.innerHTML}function saveSelection(){const a=window.getSelection();if(!a.rangeCount)return null;const e=a.getRangeAt(0),t=e.cloneRange();t.selectNodeContents(editor),t.setEnd(e.startContainer,e.startOffset);return{start:t.toString().length,end:t.toString().length+e.toString().length}}function restoreSelection(a){if(!a){placeCaretAtEnd(editor);return}const e=getTextNodes(editor);let t=0,o,n,c,l;for(const s of e){const i=s.textContent.length;o||t+i>a.start&&(o=s,n=a.start-t);c||t+i>a.end&&(c=s,l=a.end-t);t+=i}const d=window.getSelection(),f=document.createRange();o?f.setStart(o,Math.min(n,o.textContent.length)):f.setStart(editor,editor.childNodes.length),c?f.setEnd(c,Math.min(l,c.textContent.length)):f.setEnd(editor,editor.childNodes.length),d.removeAllRanges(),d.addRange(f)}function getTextNodes(a){const e=[],t=document.createTreeWalker(a,NodeFilter.SHOW_TEXT,null);for(;t.nextNode();)e.push(t.currentNode);return e}function placeCaretAtEnd(a){a.focus();const e=document.createRange();e.selectNodeContents(a),e.collapse(!1);const t=window.getSelection();t.removeAllRanges(),t.addRange(e)}function updateSidebar(a){const e=document.getElementById("sidebar");if(!e)return;const t=new Map;a.forEach(o=>{if(o.type==="keyword"&&o.keyword&&o.line){const n=o.keyword.toLowerCase();t.has(n)||t.set(n,new Set),t.get(n).add(o.line)}});const o=Array.from(t.entries()).sort((n,c)=>n[0].localeCompare(c[0]));let n=`<div class="sidebar-header"><button id="toggle-sidebar" class="sidebar-toggle">▲</button><span>keywords</span></div><div class="sidebar-content">`;o.length===0?n+=`<div>No sensitive keywords found</div>`:o.forEach(c=>{const l=Array.from(c[1]).sort((s,i)=>s-i),r=l.map(s=>`L:${s}`).join(" ");n+=`<div class="keyword-item" data-keyword="${c[0]}"><div><span class="keyword-name">${c[0]}</span></div><div><span class="keyword-lines">${r}</span></div></div>`}),n+=`</div>`,e.innerHTML=n,setTimeout(()=>{document.querySelectorAll(".keyword-lines").forEach(t=>{const o=t.textContent.match(/L:(\d+)/g);t.innerHTML=t.textContent.replace(/L:(\d+)/g,'<span class="line-number" data-line="$1">L:$1</span>');t.querySelectorAll(".line-number").forEach(n=>{n.addEventListener("click",c=>{c.stopPropagation();const l=n.dataset.line;scrollToLine(l)})})});document.querySelectorAll(".keyword-item").forEach(t=>{t.addEventListener("click",()=>{const o=t.dataset.keyword;scrollToKeywordFirst(o)})});const t=document.getElementById("toggle-sidebar");t&&t.addEventListener("click",()=>{e.classList.toggle("collapsed"),e.classList.contains("collapsed")?(t.textContent="▼",t.title="Expand sidebar"):(t.textContent="▲",t.title="Collapse sidebar")})},0)}function scrollToKeywordFirst(a){const e=document.getElementById("editor"),t=e.querySelectorAll('span.hl-keyword[data-keyword="'+a+'"]');t.length>0&&(t[0].scrollIntoView({behavior:"smooth",block:"center"}),t[0].classList.add("highlighted"),setTimeout(()=>{t[0].classList.remove("highlighted")},2e3))}function scrollToLine(a){const e=document.getElementById("editor"),t=e.querySelectorAll('span[data-line="'+a+'"]');t.length>0&&(t[0].scrollIntoView({behavior:"smooth",block:"center"}),t[0].classList.add("highlighted"),setTimeout(()=>{t[0].classList.remove("highlighted")},2e3))}editor.addEventListener("paste",a=>{a.preventDefault();const e=a.clipboardData.getData("text/plain");editor.classList.contains("placeholder")&&(editor.textContent="",editor.classList.remove("placeholder")),document.execCommand("insertText",!1,e),setTimeout(processContent,50)});editor.addEventListener("drop",a=>{a.preventDefault();const e=a.dataTransfer.getData("text/plain");e&&(editor.classList.contains("placeholder")&&(editor.textContent="",editor.classList.remove("placeholder")),document.execCommand("insertText",!1,e),processContent())});editor.addEventListener("input",()=>{clearTimeout(debounceTimer),debounceTimer=setTimeout(()=>{processContent()},150)});editor.spellcheck=false;updateSidebar([]);